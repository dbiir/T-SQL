<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Composite//EN" "ditabase.dtd">

<topic id="topic1">
  <title>Determining the Query Optimizer that is Used</title>
  <abstract>
    <shortdesc> When GPORCA is enabled (the default), you can determine if Greenplum Database is
      using GPORCA or is falling back to the Postgres Planner. </shortdesc>
  </abstract>
  <body>
    <p>You can examine the <codeph>EXPLAIN</codeph> query plan for the query determine which query
      optimizer was used by Greenplum Database to execute the query:<ul
        id="ul_vc2_xbh_1t">
        <li>When GPORCA generates the query plan, the setting
            <codeph>optimizer=on</codeph> and GPORCA version are displayed at
          the end of the query plan. For
            example.<codeblock> Settings:  <b>optimizer=on</b>
 Optimizer status: <b>Pivotal Optimizer (GPORCA) version 1.584</b></codeblock><p>When
              Greenplum Database falls back to the Postgres Planner to generate the
            plan, the setting <codeph>optimizer=on</codeph> and <codeph>Postgres query
              optimizer</codeph> are displayed at the end of the query plan. For
            example.<codeblock> Settings:  <b>optimizer=on</b>
 Optimizer status: <b>Postgres query optimizer</b></codeblock></p>When
          the server configuration parameter <codeph>OPTIMIZER</codeph> is <codeph>off</codeph>,
          these lines are displayed at the end of a query
          plan.<codeblock> Settings:  <b>optimizer=off</b>
 Optimizer status: <b>Postgres query optimizer</b></codeblock></li>
        <li>These plan items appear only in the <codeph>EXPLAIN</codeph> plan output generated by
          GPORCA. The items are not supported in a Postgres Planner query
            plan.<ul id="ul_ej2_xbh_1t">
            <li>Assert operator</li>
            <li>Sequence operator</li>
            <li>DynamicIndexScan</li>
            <li>DynamicSeqScan</li>
          </ul></li>
        <li>When a query against a partitioned table is generated by GPORCA, the
            <codeph>EXPLAIN</codeph> plan displays only the number of partitions that are being
          eliminated is listed. The scanned partitions are not shown. The <codeph>EXPLAIN</codeph>
          plan generated by the Postgres Planner lists the scanned partitions. </li>
      </ul></p>
    <p>The log file contains messages that indicate which query optimizer was used. If Greenplum Database falls back to the Postgres Planner, a message with
        <codeph>NOTICE</codeph> information is added to the log file that indicates the unsupported
      feature. Also, the label <codeph>Planner produced plan:</codeph> appears before the query in
      the query execution log message when Greenplum Database falls back to the Postgres
      optimizer. </p>
    <note> You can configure Greenplum Database to display log messages on the psql
      command line by setting the Greenplum Database server configuration parameter
        <codeph>client_min_messages</codeph> to <codeph>LOG</codeph>. See the <cite>Greenplum Database Reference Guide</cite> for information about the parameter.</note>
  </body>
  <topic id="topic_n4w_nb5_xr">
    <title>Examples</title>
    <body>
      <p>This example shows the differences for a query that is run against partitioned tables when
        GPORCA is enabled.</p>
      <p>This <codeph>CREATE TABLE</codeph> statement creates a table with single level partitions:
        <codeblock>CREATE TABLE sales (trans_id int, date date, 
    amount decimal(9,2), region text)
   DISTRIBUTED BY (trans_id)
   PARTITION BY RANGE (date)
      (START (date '2016­01­01') 
       INCLUSIVE END (date '2017­01­01') 
       EXCLUSIVE EVERY (INTERVAL '1 month'),
   DEFAULT PARTITION outlying_dates );</codeblock></p>
      <p>This query against the table is supported by GPORCA and does not
        generate errors in the log file:<codeblock>select * from sales ;</codeblock></p>
      <p>The <codeph>EXPLAIN</codeph> plan output lists only the number of selected
        partitions.<codeblock> ->  Partition Selector for sales (dynamic scan id: 1)  (cost=10.00..100.00 rows=50 width=4)
       <b>Partitions selected:  13 (out of 13)</b></codeblock></p>
      <p>If a query against a partitioned table is not supported by GPORCA.
          Greenplum Database falls back to the Postgres Planner. The
          <codeph>EXPLAIN</codeph> plan generated by the Postgres Planner lists the selected
        partitions. This example shows a part of the explain plan that lists some selected
        partitions.</p>
      <p>
        <codeblock> ->  Append  (cost=0.00..0.00 rows=26 width=53)
     <b>->  Seq Scan on sales2_1_prt_7_2_prt_usa sales2  (cost=0.00..0.00 rows=1 width=53)
     ->  Seq Scan on sales2_1_prt_7_2_prt_asia sales2  (cost=0.00..0.00 rows=1 width=53)
     ...</b></codeblock>
      </p>
      <p>This example shows the log output when the Greenplum Database falls back to
        the Postgres Planner from GPORCA. </p>
      <p>When this query is run, Greenplum Database falls back to the Postgres Planner.<codeblock>explain select * from pg_class;</codeblock></p>
      <p>A message is added to the log file. The message contains this <codeph>NOTICE</codeph>
        information that indicates the reason GPORCA did not execute the
        query:<codeblock>NOTICE,""Feature not supported: Queries on master-only tables"</codeblock></p>
    </body>
  </topic>
</topic>
