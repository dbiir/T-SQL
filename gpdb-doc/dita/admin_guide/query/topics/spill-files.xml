<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE topic PUBLIC "-//OASIS//DTD DITA Composite//EN" "ditabase.dtd">

<topic id="topic_bvh_cg4_t4">
  <title>Managing Spill Files Generated by Queries</title>
  <abstract><shortdesc>Greenplum Database creates spill files, also known as workfiles, on disk if
      it does not have sufficient memory to execute an SQL query in memory. </shortdesc>The maximum
     number of spill files for a given query is governed by the <codeph><xref
       href="../../../ref_guide/config_params/guc-list.xml#gp_workfile_limit_files_per_query"
       >gp_workfile_limit_files_per_query</xref></codeph> server configuration parameter
      setting. The default value of 100,000 spill files is sufficient for the majority of
      queries.
    <p>If a query creates more than the configured number of spill files, Greenplum
      Database returns this error:</p></abstract>

  <body>

    <codeblock>ERROR: number of workfiles per query limit exceeded</codeblock>

    <p>Greenplum Database may generate a large number of spill files when:<ul
        id="ul_dl2_1j4_t4">
        <li>Data skew is present in the queried data. To check for data skew,
          see <xref href="../../managing/monitor.xml#topic20"
          >Checking for Data Distribution Skew</xref>.</li>
        <li>The amount of memory allocated for the query is too low. You control
          the maximum amount of memory that can be used by a query with the Greenplum
          Database server configuration parameters
          <codeph><xref href="../../../ref_guide/config_params/guc-list.xml#max_statement_mem"
           >max_statement_mem</xref></codeph>
           and <codeph><xref href="../../../ref_guide/config_params/guc-list.xml#statement_mem"
           >statement_mem</xref></codeph>, or through resource group or resource queue
           configuration.</li>
      </ul></p>

    <p>You might be able to run the query successfully by changing the query, changing the data
      distribution, or changing the system memory configuration. The <codeph>gp_toolkit</codeph>
      <i>gp_workfile_*</i> views display spill file usage information. You can use this
      information to troubleshoot and tune queries. The <i>gp_workfile_*</i> views are
      described in <xref href="../../../ref_guide/gp_toolkit.xml#topic32"
      >Checking Query Disk Spill Space Usage</xref>.</p>

    <p>Additional documentation resources:</p>
    <ul>
      <li><xref href="../../../ref_guide/config_params/guc_category-list.xml#topic15"
        >Memory Consumption Parameters</xref> identifies the memory-related spill file
        server configuration parameters.</li>
      <li><xref href="../../workload_mgmt_resgroups.xml#topic1"/> describes memory and
        spill considerations when resource group-based resource management is
        active.</li>
      <li><xref href="../../workload_mgmt.xml#topic1"/> describes memory and spill
        considerations when resource queue-based resource management is active.</li>
    </ul>

  </body>
</topic>
